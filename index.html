<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† â€“ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</title>
<style>
body { font-family: "Cairo", sans-serif; background:#eef2f7; margin:0; padding:0;}
.container{max-width:1100px; margin:auto; padding:20px;}
.card{background:white; border-radius:10px; padding:20px; margin:20px 0; box-shadow:0 5px 20px rgba(0,0,0,0.1);}
input,select,button{padding:12px; margin:6px 0; width:100%; border-radius:8px; border:1px solid #ccc; font-size:16px;}
button{background:#007bff; color:white; border:none; cursor:pointer;}
button:hover{background:#0056c7;}
table{width:100%; border-collapse:collapse; margin-top:10px;}
th,td{padding:10px; border:1px solid #ddd; text-align:center;}
.success{color:green; font-weight:bold;}
.error{color:red; font-weight:bold;}
.alert{color:#d40000; font-weight:bold;}
.header{background:#0d6efd; padding:20px; color:white; text-align:center; font-size:24px; font-weight:bold;}
.hide{display:none;}
</style>
</head>
<body>

<div class="header">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ÙˆØ§Ø¯ â€“ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</div>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<p id="loginMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="app" class="hide">

<h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="loggedUser"></span></h2>

<div class="card">
<h3>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
<table id="inventoryTable">
<tr>
<th>Ø§Ù„ØµÙ†Ù</th>
<th>Ø§Ù„ÙØ¦Ø©</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</th>
<th>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
</tr>
</table>
</div>

<div class="card">
<h3>â• Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ / ØµØ±Ù</h3>

<label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
<input id="item">

<label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
<input id="qty" type="number">

<label>ÙØ¦Ø© Ø§Ù„ØµÙ†Ù (Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯)</label>
<input id="category" placeholder="Ù…Ø«Ø§Ù„: Ø¨ÙˆÙÙŠÙ‡ / ØªÙ†Ø¸ÙŠÙ / Ù…Ø´Ø±ÙˆØ¨Ø§Øª">

<label>Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ù„Ù„ØµÙ†Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯)</label>
<input id="low_alert" type="number" placeholder="Ù…Ø«Ø§Ù„: 5">

<label>Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù†</label>
<select id="approver">
<option value="HR">HR</option>
<option value="Store">Ø£Ù…ÙŠÙ† Ù…Ø®Ø²Ù†</option>
</select>

<button onclick="sendRequest()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
<p id="reqMsg"></p>
</div>

<div class="card">
<h3>âœ”ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©</h3>
<table id="requestsTable">
<tr>
<th>ID</th>
<th>Ø§Ù„ØµÙ†Ù</th>
<th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø±Ø³Ù„</th>
<th>Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù†</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</table>
</div>

</div>

</div>

<script>
// ğŸŒ Ø±Ø§Ø¨Ø· Google Apps Script
const API = "PUT-YOUR-APPSCRIPT-URL-HERE";

// ğŸ” Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ†
const localUsers = [
 {username:"basem", password:"123", role:"Manager"},
 {username:"hr", password:"123", role:"HR"},
 {username:"store", password:"123", role:"Store"},
];

let CURRENT_USER = "";

// ====== LOGIN SYSTEM ======
function login(){
  let u = document.getElementById("username").value;
  let p = document.getElementById("password").value;
  let msg = document.getElementById("loginMsg");

  let found = localUsers.find(x=>x.username===u && x.password===p);
  if(!found){
    msg.innerHTML="<span class='error'>âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©</span>";
    return;
  }

  CURRENT_USER = found.role;
  document.getElementById("loggedUser").innerText = found.username + " ("+found.role+")";

  document.getElementById("loginBox").classList.add("hide");
  document.getElementById("app").classList.remove("hide");

  loadInventory();
  loadRequests();
}

// ===== LOAD INVENTORY =====
async function loadInventory(){
  const res = await fetch(API,{method:"POST", body:JSON.stringify({action:"get_inventory"})});
  const data = await res.json();

  let tb = document.getElementById("inventoryTable");
  tb.innerHTML = `
  <tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
  `;

  data.inventory.forEach(r=>{
    let warn = (Number(r[2]) <= Number(r[3])) ? "<span class='alert'>âš ï¸ Ù†Ø§Ù‚Øµ</span>" : "âœ”ï¸ Ø¬ÙŠØ¯";
    tb.innerHTML += `
    <tr>
      <td>${r[0]}</td>
      <td>${r[1]}</td>
      <td>${r[2]}</td>
      <td>${r[3]}</td>
      <td>${warn}</td>
    </tr>
    `;
  });
}

// ===== SEND REQUEST =====
async function sendRequest(){
  let item = document.getElementById("item").value;
  let qty = Number(document.getElementById("qty").value);
  let cat = document.getElementById("category").value || "ØºÙŠØ± Ù…ØµÙ†Ù";
  let low = Number(document.getElementById("low_alert").value) || 5;
  let approver = document.getElementById("approver").value;

  if(!item || !qty){
    document.getElementById("reqMsg").innerHTML="<span class='error'>âŒ Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>";
    return;
  }

  const res = await fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"create_request",
      item:item,
      qty:qty,
      sender:CURRENT_USER,
      approver:approver,
      category:cat,
      low_alert:low
    })
  });

  const data = await res.json();
  if(data.success){
    document.getElementById("reqMsg").innerHTML="<span class='success'>âœ”ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</span>";
    loadRequests();
  }
}

// ===== LOAD REQUESTS =====
async function loadRequests(){
  const res = await fetch(API,{method:"POST", body:JSON.stringify({action:"get_requests"})});
  const data = await res.json();

  let tb = document.getElementById("requestsTable");
  tb.innerHTML = `
  <tr>
  <th>ID</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ù…Ø±Ø³Ù„</th><th>Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù†</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
  </tr>`;

  data.requests.forEach(r=>{
    let BTN = "";
    if(r[4] === CURRENT_USER){
      BTN = `<button onclick="approve(${r[0]})">Ù…ÙˆØ§ÙÙ‚Ø©</button>`;
    }

    tb.innerHTML += `
    <tr>
      <td>${r[0]}</td>
      <td>${r[1]}</td>
      <td>${r[2]}</td>
      <td>${r[3]}</td>
      <td>${r[4]}</td>
      <td>${BTN}</td>
    </tr>`;
  });
}

// ===== APPROVE REQUEST =====
async function approve(id){
  const res = await fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"approve", id:id, approver:CURRENT_USER})
  });
  const data = await res.json();
  if(data.success){
    alert("âœ”ï¸ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ§Ù„Ø®ØµÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ");
    loadInventory();
    loadRequests();
  }
}
</script>
</body>
</html>
